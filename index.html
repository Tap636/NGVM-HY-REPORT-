<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Report Card System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background-color: #f4f7fc;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2a4d69;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      max-width: 800px;
      margin: 0 auto;
    }
    input, select, button {
      margin: 6px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #2a4d69;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #1d3557;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      text-align: center;
      padding: 6px;
    }
    th {
      background-color: #2a4d69;
      color: white;
    }
  </style>

  <!-- External libraries for PDF + ZIP download -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
  <h1>ðŸ“˜ Student Report Card System</h1>
  <div class="container">
    <label>Student Name:</label>
    <input type="text" id="studentName" placeholder="Enter student name" />
    <label>Class:</label>
    <input type="text" id="studentClass" placeholder="Enter class" />
    <button onclick="addStudent()">Add Student</button>
    <button onclick="bulkDownloadReports()">Bulk Download Reports (PDF)</button>

    <table id="studentTable">
      <thead>
        <tr>
          <th>Student Name</th>
          <th>Class</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const students = [];

    function addStudent() {
      const name = document.getElementById('studentName').value.trim();
      const cls = document.getElementById('studentClass').value.trim();
      if (!name || !cls) {
        alert("Please enter both name and class.");
        return;
      }

      const newStudent = {
        name,
        class: cls,
        halfYearly: {
          English: { written: 85, practical: 0, oral: 10 },
          Math: { written: 90, practical: 0, oral: 9 },
          Science: { written: 88, practical: 8, oral: 9 }
        },
        annual: {
          English: { written: 80, practical: 0, oral: 10 },
          Math: { written: 92, practical: 0, oral: 9 },
          Science: { written: 86, practical: 8, oral: 10 }
        },
        remarks: "Excellent performance!",
        result: "Pass"
      };
      students.push(newStudent);
      displayStudents();
      document.getElementById('studentName').value = '';
      document.getElementById('studentClass').value = '';
    }

    function displayStudents() {
      const tbody = document.querySelector("#studentTable tbody");
      tbody.innerHTML = "";
      students.forEach((s, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${s.name}</td>
          <td>${s.class}</td>
          <td><button onclick="downloadSingleReport(${i})">Download Report (PDF)</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function getGrade(total) {
      if (total >= 90) return "A+";
      if (total >= 80) return "A";
      if (total >= 70) return "B";
      if (total >= 60) return "C";
      if (total >= 50) return "D";
      return "F";
    }

    function generatePDF(s) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(16);
      doc.text("Student Report Card", 10, 15);
      doc.setFontSize(12);
      doc.text(`Name: ${s.name}`, 10, 25);
      doc.text(`Class: ${s.class}`, 10, 32);

      let y = 45;
      doc.setFontSize(14);
      doc.text("Half-Yearly Exam", 10, y);
      y += 6;
      for (const [subject, marks] of Object.entries(s.halfYearly)) {
        const total = marks.written + marks.practical + marks.oral;
        const grade = getGrade(total);
        doc.text(`${subject}: W-${marks.written}, P-${marks.practical}, O-${marks.oral}, Total-${total}, Grade-${grade}`, 10, y);
        y += 6;
      }

      y += 4;
      doc.setFontSize(14);
      doc.text("Annual Exam", 10, y);
      y += 6;
      for (const [subject, marks] of Object.entries(s.annual)) {
        const total = marks.written + marks.practical + marks.oral;
        const grade = getGrade(total);
        doc.text(`${subject}: W-${marks.written}, P-${marks.practical}, O-${marks.oral}, Total-${total}, Grade-${grade}`, 10, y);
        y += 6;
      }

      y += 10;
      doc.setFontSize(14);
      doc.text(`Remarks: ${s.remarks}`, 10, y);
      y += 6;
      doc.text(`Result: ${s.result}`, 10, y);

      return doc;
    }

    function downloadSingleReport(index) {
      const s = students[index];
      const doc = generatePDF(s);
      doc.save(`${s.name.replace(/\s+/g, "_")}_Report.pdf`);
    }

    async function bulkDownloadReports() {
      if (students.length === 0) {
        alert("No students available for download.");
        return;
      }

      const zip = new JSZip();

      for (const s of students) {
        const doc = generatePDF(s);
        const pdfBlob = doc.output("blob");
        zip.file(`${s.name.replace(/\s+/g, "_")}_Report.pdf`, pdfBlob);
      }

      const content = await zip.generateAsync({ type: "blob" });
      saveAs(content, "All_Student_Reports.zip");
    }
  </script>
</body>
</html>
